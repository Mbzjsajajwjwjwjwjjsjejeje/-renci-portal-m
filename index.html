<!DOCTYPE html>
<html lang="tr">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>√ñƒürenci Portalƒ±m V30</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root { 
            --primary: #6c5ce7; 
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --panel: rgba(255, 255, 255, 0.95);
            --text: #2d3436; 
            --success: #00b894; 
            --danger: #d63031;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        body.koyu-mod { 
            --primary: #a29bfe; 
            --panel: #2d3436; 
            --text: #dfe6e9; 
            --bg-gradient: linear-gradient(135deg, #232526 0%, #414345 100%);
        }
        
        body { font-family: 'Poppins', sans-serif; background: var(--bg-gradient); margin: 0; min-height: 100vh; display: flex; justify-content: center; align-items: center; color: var(--text); overflow: hidden; }
        
        @media screen and (max-width: 768px) {
            body, .container { flex-direction: column !important; width: 100% !important; padding: 0 !important; height: 100vh !important; border-radius: 0 !important; }
            .sidebar { width: 100% !important; height: auto !important; padding: 10px !important; display: flex; overflow-x: auto; gap: 10px; border-bottom: 1px solid #eee; border-right: none !important; }
            .sidebar h3, .sidebar p, .sidebar button { display: none; }
            .menu-item { flex-direction: column; font-size: 10px; padding: 8px; text-align: center; min-width: 65px; }
            .menu-item i { font-size: 20px; margin-bottom: 5px; }
            .auth-box { width: 90% !important; padding: 30px 20px !important; }
            #myBoard { width: 300px !important; }
            .content { padding: 15px !important; }
        }

        .container { background: var(--panel); width: 1250px; height: 850px; border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); display: flex; overflow: hidden; position: relative; backdrop-filter: blur(10px); }
        
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index:999; display:flex; justify-content:center; align-items:center; }
        .auth-box { padding: 50px; width: 400px; text-align: center; background: white; border-radius: 24px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .input-group input { width: 100%; padding: 16px; margin-bottom: 12px; border: 2px solid #e2e8f0; border-radius: 12px; background: #f8fafc; outline: none; transition: 0.3s; box-sizing: border-box; font-size: 15px; }
        .auth-btn { width: 100%; padding: 16px; border: none; border-radius: 12px; background: var(--primary); color: white; font-weight: 600; cursor: pointer; transition: 0.3s; margin-top: 10px; font-size: 16px; }
        .auth-btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .link-text { color: var(--primary); font-weight: 500; cursor: pointer; font-size: 14px; margin-top: 20px; display: block; }

        .sidebar { width: 260px; background: rgba(255,255,255,0.5); padding: 30px; display: flex; flex-direction: column; gap: 12px; border-right: 1px solid rgba(0,0,0,0.05); }
        .content { flex: 1; padding: 40px; overflow-y: auto; scroll-behavior: smooth; }
        .menu-item { padding: 14px 18px; cursor: pointer; border-radius: 14px; display: flex; gap: 15px; align-items: center; color: #64748b; transition: all 0.3s ease; font-weight: 500; }
        .menu-item:hover { background: rgba(108, 92, 231, 0.1); color: var(--primary); transform: translateX(5px); }
        .menu-item.active { background: var(--primary); color: white; box-shadow: 0 4px 6px -1px rgba(108, 92, 231, 0.3); }
        
        .page { display: none; animation: fadeIn 0.4s ease-out; } .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .gizli { display: none !important; }

        .chess-container { display: flex; flex-direction: column; align-items: center; background: #fff; padding: 30px; border-radius: 20px; box-shadow: var(--shadow); border: 1px solid #eee; }
        #myBoard { width: 420px; border: 8px solid #474747; border-radius: 4px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .timers { display: flex; justify-content: space-between; width: 420px; margin-bottom: 20px; font-family: 'Courier New', monospace; }
        .timer-box { background: #2d3436; color: #fff; padding: 10px 20px; border-radius: 8px; font-size: 24px; font-weight: bold; width: 140px; text-align: center; border: 3px solid transparent; }
        .timer-active { border-color: #00b894; color: #00b894; box-shadow: 0 0 15px rgba(0,184,148,0.3); }

        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .stat-card { background: white; padding: 25px; border-radius: 16px; box-shadow: var(--shadow); border-left: 6px solid var(--primary); }
        
        .btn { padding: 12px 24px; border: none; border-radius: 10px; cursor: pointer; color: white; font-weight: 600; transition: 0.2s; font-size: 14px; }
        .btn:hover { transform: translateY(-2px); opacity: 0.9; }
        .btn-yesil { background: var(--success); } .btn-kirmizi { background: var(--danger); } .btn-gri { background: #636e72; }
        
        input, textarea, select { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: var(--shadow); }
        th { background: var(--primary); color: white; padding: 15px; }
        td { padding: 10px; border-bottom: 1px solid #eee; }
        .ders-input { border: none; background: transparent; width: 100%; text-align: center; font-weight: 500; }
        .item-card { background: white; padding: 16px; margin-bottom: 10px; border-radius: 12px; border-left: 5px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .calc-group { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid #eee; }
        .calc-title { font-size: 16px; font-weight: bold; color: var(--primary); margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 5px; }

        .pomodoro-circle { width: 220px; height: 220px; border-radius: 50%; border: 8px solid #eee; border-top-color: var(--primary); display: flex; justify-content: center; align-items: center; font-size: 50px; font-weight: bold; margin: 20px auto; color: var(--text); }

        #beklemeEkrani { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.95); z-index: 99; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="authScreen" class="overlay">
        <div class="auth-box">
            <i class="fas fa-user-graduate" style="font-size: 48px; color: var(--primary); margin-bottom: 20px;"></i>
            <h2 id="authTitle" style="color:#2d3436; margin-bottom: 5px;">√ñƒürenci Giri≈üi</h2>
            <p style="color:#64748b; margin-bottom: 25px; font-size: 14px;">Portalƒ±na eri≈ümek i√ßin kimliƒüini doƒürula.</p>
            <div class="input-group"><input type="text" id="kAdiInput" placeholder="Kullanƒ±cƒ± Adƒ±"></div>
            <div id="emailDiv" class="input-group gizli"><input type="email" id="emailInput" placeholder="E-Posta (≈ûifre kurtarma i√ßin)"></div>
            <div class="input-group"><input type="password" id="sifreInput" placeholder="≈ûifre"></div>
            <button onclick="islemYap()" id="btnIslem" class="auth-btn">Giri≈ü Yap</button>
            <span onclick="sifreSifirla()" class="link-text">≈ûifremi Unuttum?</span>
            <span onclick="modDegistir()" id="toggleText" class="link-text" style="color:#64748b; margin-top:25px;">Hesabƒ±n yok mu? <b style="color:var(--primary)">Kayƒ±t Ol</b></span>
        </div>
    </div>

    <div id="appScreen" class="container gizli">
        <div class="sidebar">
            <h3 style="text-align:center; color: var(--primary); margin-bottom: 30px; font-size: 22px; font-weight: 800;"><i class="fas fa-graduation-cap"></i> PORTAL</h3>
            <div class="menu-item active" onclick="sayfaGec('dashboard')"><i class="fas fa-home"></i> Ana Sayfa</div>
            <div class="menu-item" onclick="sayfaGec('pomodoro')"><i class="fas fa-clock"></i> Ders & Mola</div>
            <div class="menu-item" onclick="sayfaGec('oyunlar')"><i class="fas fa-chess-king"></i>  Arena</div>
            <div class="menu-item" onclick="sayfaGec('todo')"><i class="fas fa-check-circle"></i> G√∂revler</div>
            <div class="menu-item" onclick="sayfaGec('notlar')"><i class="fas fa-calculator"></i> Hesaplamalar</div>
            <div class="menu-item" onclick="sayfaGec('program')"><i class="fas fa-calendar-alt"></i> Ders Programƒ±</div>
            <div class="menu-item" onclick="sayfaGec('gunluk')"><i class="fas fa-book"></i> Gizli G√ºnl√ºk</div>
            <div class="menu-item" onclick="sayfaGec('sohbet')"><i class="fas fa-comments"></i> Sohbet</div>
            <div class="menu-item" onclick="sayfaGec('iletisim')"><i class="fas fa-envelope"></i> √ñneri Kutusu</div>
            <div style="margin-top:auto; text-align:center;">
                <p id="karsilama" style="font-size:13px; font-weight:600; color:#64748b; margin-bottom: 10px;"></p>
                <button onclick="cikisYap()" class="btn btn-kirmizi" style="width:100%; font-size:13px; padding: 10px;">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </div>

        <div class="content">
            <div id="dashboard" class="page active">
                <h1 style="color:var(--text);">üëã Ho≈ügeldin, <span id="dashUser" style="color:var(--primary);"></span></h1>
                <div class="card-grid" style="margin-top:30px;">
                    <div class="stat-card"><h3>‚ôüÔ∏è Satran√ß Puanƒ±</h3><h1 id="dashPuan" style="font-size:40px; margin:10px 0; color:var(--primary);">0</h1></div>
                    <div class="stat-card" style="border-left-color: var(--success);"><h3>‚úÖ Bekleyen G√∂rev</h3><h1 id="dashGorev" style="font-size:40px; margin:10px 0; color:var(--success);">0</h1></div>
                </div>
            </div>

            <div id="pomodoro" class="page" style="text-align:center;">
                <h2 style="margin-bottom: 20px;">üçÖ Pomodoro Odaklanma</h2>
                <div style="display:flex; justify-content:center; gap:15px; margin-bottom:20px;">
                    <div style="text-align:left;">
                        <label style="font-size:12px; font-weight:bold; color:#64748b;">Ders (dk)</label>
                        <input type="number" id="pomoDersSure" value="25" style="width:90px; text-align:center; font-weight:bold;">
                    </div>
                    <div style="text-align:left;">
                        <label style="font-size:12px; font-weight:bold; color:#64748b;">Mola (dk)</label>
                        <input type="number" id="pomoMolaSure" value="5" style="width:90px; text-align:center; font-weight:bold;">
                    </div>
                </div>
                <div class="pomodoro-circle" id="pomoSure" style="font-family: 'Courier New', monospace;">25:00</div>
                <p id="pomoDurumYazisi" style="font-size:18px; color:var(--primary); font-weight:600; min-height: 24px; margin-top: 15px;"></p>
                <div style="margin-top:30px; display:flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-yesil" onclick="dersBaslat()">üìö Ders Ba≈ülat</button>
                    <button class="btn btn-yesil" style="background:#0984e3;" onclick="molaBaslat()">‚òï Mola Ver</button>
                    <button id="pomoDurBtn" class="btn btn-kirmizi" onclick="pomoDuraklat()">üõë Durdur</button>
                </div>
            </div>

            <div id="oyunlar" class="page" style="position: relative;">
                <div id="beklemeEkrani" class="gizli"><div id="beklemeIcerik"><div class="spinner"></div><h2>RAKƒ∞P ARANIYOR...</h2><button onclick="beklemeyiIptalEt()" class="btn btn-kirmizi">ƒ∞ptal</button></div><div id="geriSayimIcerik" class="gizli" style="text-align:center;"><h2>RAKƒ∞P BULUNDU!</h2><h1 id="geriSayimText" style="font-size:100px; color:var(--primary); margin:0;">5</h1></div></div>
                <h2 style="text-align:center; margin-bottom: 20px;">‚ôüÔ∏è Satran√ß Arenasƒ±</h2>
                <div id="lobiButonlari" style="text-align:center; padding:50px; background:white; border-radius:20px; box-shadow: var(--shadow);"><button class="btn btn-gri" onclick="oyunModuSec('bot')" style="font-size: 16px; padding: 15px 30px;">ü§ñ Bot ile Oyna</button> <button class="btn btn-yesil" onclick="dereceliGir()" style="font-size: 16px; padding: 15px 30px; margin-left: 10px;">üî• Online Dereceli</button></div>
                <div id="oyunAlani" class="gizli" style="text-align:center;">
                    <div class="chess-container">
                        <div class="timers"><div id="timerW" class="timer-box">‚ö™ 10:00</div><div id="timerB" class="timer-box">‚ö´ 10:00</div></div>
                        <div id="myBoard"></div>
                        <div style="margin-top:25px;"><button class="btn btn-kirmizi" onclick="pesEt()">üè≥Ô∏è Pes Et / √áƒ±k</button></div>
                    </div>
                </div>
            </div>

            <div id="todo" class="page">
                <h2>‚è±Ô∏è Zamanlƒ± G√∂revler</h2>
                <div style="display:flex; gap:10px; margin-bottom: 20px;">
                    <input id="todoIn" placeholder="G√∂rev tanƒ±mƒ±? (√ñrn: 50 soru Matematik √ß√∂z)">
                    <input type="number" id="todoTime" placeholder="S√ºre (Sn)" style="width:120px;">
                    <button class="btn btn-yesil" style="width:140px;" onclick="gorevEkle()">Ba≈ülat</button>
                </div>
                <div id="todoList"></div>
            </div>

            <div id="notlar" class="page">
                <h2>üßÆ Hesaplama Merkezi</h2>
                <div class="calc-group">
                    <div class="calc-title">üéì √úniversite Not Hesapla</div>
                    <div style="display:flex; gap:10px;">
                        <input id="dersAdi" placeholder="Ders Adƒ±">
                        <input id="vizeNot" type="number" placeholder="Vize (%40)">
                        <input id="finalNot" type="number" placeholder="Final (%60)">
                        <button class="btn btn-yesil" onclick="notHesapla()">Hesapla</button>
                    </div>
                </div>
                <div class="calc-group">
                    <div class="calc-title">üè´ Lise Ortalama Hesapla</div>
                    <div style="display:flex; gap:10px;">
                        <input id="liseDers" placeholder="Ders Adƒ±">
                        <input id="yazili1" type="number" placeholder="1. Yazƒ±lƒ±">
                        <input id="yazili2" type="number" placeholder="2. Yazƒ±lƒ±">
                        <input id="sozlu" type="number" placeholder="S√∂zl√º">
                        <button class="btn btn-yesil" onclick="liseHesapla()">Hesapla</button>
                    </div>
                </div>
                <div class="calc-group">
                    <div class="calc-title">üìù TYT / AYT Net Hesapla</div>
                    <div style="display:flex; gap:10px; align-items: center;">
                        <input id="tytDers" placeholder="Ders (√ñrn: Matematik)">
                        <input id="tytDogru" type="number" placeholder="Doƒüru">
                        <input id="tytYanlis" type="number" placeholder="Yanlƒ±≈ü">
                        <button class="btn btn-yesil" style="background: #e17055;" onclick="tytHesapla()">Neti G√∂r</button>
                    </div>
                </div>
                <div id="notListesi"></div>
            </div>

            <div id="program" class="page">
                <h2>üìÖ Haftalƒ±k Ders Programƒ± (09:00 - 18:00)</h2>
                <div style="overflow-x:auto;">
                    <table id="programTablosu"><thead><tr><th>Saat</th><th>Pzt</th><th>Sal</th><th>√áar</th><th>Per</th><th>Cum</th></tr></thead><tbody></tbody></table>
                </div>
                <button class="btn btn-yesil" style="margin-top:20px; width: 100%;" onclick="programKaydet()">Tabloyu Kaydet</button>
            </div>

            <div id="gunluk" class="page">
                <h2>üìî Gizli G√ºnl√ºk</h2>
                <p style="font-size:13px; color:#64748b; margin-bottom: 10px;">Yazdƒ±klarƒ±n ≈üifrelenir ve sadece "Oku" butonuna basƒ±nca g√∂r√ºn√ºr.</p>
                <textarea id="gunlukIn" rows="6" placeholder="Bug√ºn neler ya≈üadƒ±n? (√ñrn: Bug√ºn projemde √ßok ilerledim...)"></textarea>
                <button class="btn btn-yesil" onclick="gunlukEkle()" style="width: 100%;">G√ºnl√ºƒüe Kilitle üîí</button>
                <div id="gunlukList" style="margin-top:25px;"></div>
            </div>

            <div id="sohbet" class="page">
                <h2>üí¨ Genel Sohbet</h2>
                <div id="chatArea" style="height:450px; overflow-y:scroll; border:1px solid #e2e8f0; padding:20px; border-radius:16px; background:#f8fafc; margin-bottom:15px;"></div>
                <div style="display:flex; gap:10px;">
                    <input id="chatIn" placeholder="Bir mesaj yaz...">
                    <button class="btn btn-yesil" style="width:120px;" onclick="chatYolla()"><i class="fas fa-paper-plane"></i> Yolla</button>
                </div>
            </div>

            <div id="iletisim" class="page">
                <h2>üì¨ ≈ûikayet ve √ñneri Kutusu</h2>
                <select id="oneriTur"><option value="√ñneri">üí° √ñneri</option><option value="≈ûikayet">‚ö†Ô∏è ≈ûikayet</option></select>
                <input id="oneriKonu" placeholder="Konu Ba≈ülƒ±ƒüƒ±">
                <textarea id="oneriMesaj" rows="6" placeholder="Mesajƒ±nƒ±zƒ± buraya yazƒ±n..."></textarea>
                <button class="btn btn-yesil" onclick="oneriYolla()" style="background:#6c5ce7; width:100%;">üìß E-Posta Hazƒ±rla ve G√∂nder</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyDxsw-OTjvlrPvscjO4LsGzKEceKOW-Iuc",
          authDomain: "ogrenci-portali-f4cad.firebaseapp.com",
          databaseURL: "https://ogrenci-portali-f4cad-default-rtdb.firebaseio.com",
          projectId: "ogrenci-portali-f4cad",
          storageBucket: "ogrenci-portali-f4cad.firebasestorage.app",
          messagingSenderId: "901945087688",
          appId: "1:901945087688:web:24f1a877f49a15edc577fd",
          measurementId: "G-JEL3H6H45T"
        };

        try { firebase.initializeApp(firebaseConfig); } catch(e){ console.error(e); }
        const database = firebase.database();
        const auth = firebase.auth();

        let user = null, kayit = false;
        let board = null, game = new Chess();
        let myColor = 'w', aktifMod = null, wTime=600, bTime=600, chessInterval=null;

        if(localStorage.getItem("koyuMod") === "1") document.body.classList.add("koyu-mod");

        function modDegistir() { kayit = !kayit; document.getElementById("authTitle").innerText = kayit ? "Kayƒ±t Ol" : "Giri≈ü Yap"; document.getElementById("btnIslem").innerText = kayit ? "Kayƒ±t Ol" : "Giri≈ü Yap"; document.getElementById("toggleText").innerHTML = kayit ? "Hesabƒ±n var mƒ±? <b>Giri≈ü Yap</b>" : "Hesabƒ±n yok mu? <b>Kayƒ±t Ol</b>"; kayit ? document.getElementById("emailDiv").classList.remove("gizli") : document.getElementById("emailDiv").classList.add("gizli"); }
        function islemYap() {
            let k=document.getElementById("kAdiInput").value.trim(), p=document.getElementById("sifreInput").value;
            if(!k||!p) return alert("Doldur!");
            if(kayit) {
                let m=document.getElementById("emailInput").value.trim(); if(!m) return alert("Email lazƒ±m!");
                database.ref('users').orderByChild('username').equalTo(k).once('value', s=>{
                    if(s.exists()) alert("Alƒ±nmƒ±≈ü!");
                    else auth.createUserWithEmailAndPassword(m,p).then(c=>{ database.ref('users/'+c.user.uid).set({username:k,email:m}); alert("Kayƒ±t OK!"); }).catch(e=>alert(e.message));
                });
            } else {
                database.ref('users').orderByChild('username').equalTo(k).once('value', s=>{
                    if(s.exists()) auth.signInWithEmailAndPassword(Object.values(s.val())[0].email,p).catch(e=>alert("≈ûifre Yanlƒ±≈ü!"));
                    else alert("Yok!");
                });
            }
        }
        auth.onAuthStateChanged(u=>{ if(u){ database.ref('users/'+u.uid).once('value').then(s=>{ user=s.exists()?s.val().username:u.email.split('@')[0]; document.getElementById("authScreen").classList.add("gizli"); document.getElementById("appScreen").classList.remove("gizli"); document.getElementById("karsilama").innerText="üë§ "+user; document.getElementById("dashUser").innerText=user; yukleVeriler(); baslatSohbet(); }); } else { document.getElementById("authScreen").classList.remove("gizli"); document.getElementById("appScreen").classList.add("gizli"); } });
        function cikisYap(){auth.signOut().then(()=>location.reload());}
        function sifreSifirla(){let m=prompt("Email:");if(m)auth.sendPasswordResetEmail(m).then(()=>alert("G√∂nderildi")).catch(e=>alert(e.message));}
        function getRef(p){return database.ref(p+'/'+user);}

        let pInt, pSur=25*60, pDur=false, pMod=""; 
        function dersBaslat() {
            let dk = parseInt(document.getElementById("pomoDersSure").value) || 25;
            if(pMod === 'mola' && pSur > 0 && pDur) return alert("Moladasƒ±n!");
            if(pMod !== 'ders') { clearInterval(pInt); pSur = dk * 60; pMod = 'ders'; }
            pDur = true; document.getElementById("pomoDurBtn").innerText = "Durdur"; 
            document.getElementById("pomoDurumYazisi").innerText = "üìö DERS (" + dk + " dk)";
            sayac();
        }
        function molaBaslat() {
            let dk = parseInt(document.getElementById("pomoMolaSure").value) || 5;
            if(pMod === 'ders' && pSur > 0 && pDur) return alert("Derstesin!");
            if(pMod !== 'mola') { clearInterval(pInt); pSur = dk * 60; pMod = 'mola'; }
            pDur = true; document.getElementById("pomoDurBtn").innerText = "Durdur";
            document.getElementById("pomoDurumYazisi").innerText = "‚òï MOLA (" + dk + " dk)";
            sayac();
        }
        function sayac() {
            clearInterval(pInt); pInt = setInterval(() => {
                pSur--; let m=Math.floor(pSur/60), s=pSur%60;
                document.getElementById("pomoSure").innerText = `${m}:${s<10?'0':''}${s}`;
                if(pSur<=0) { clearInterval(pInt); alert("S√ºre bitti!"); pDur = false; }
            }, 1000);
        }
        function pomoDuraklat() { if(pDur){clearInterval(pInt);pDur=false;document.getElementById("pomoDurBtn").innerText="Devam Et";}else{pDur=true;document.getElementById("pomoDurBtn").innerText="Durdur";sayac();} }

        function oyunBaslat(mod) {
            aktifMod = mod; document.getElementById("beklemeEkrani").classList.add("gizli"); document.getElementById("oyunAlani").classList.remove("gizli"); document.getElementById("lobiButonlari").classList.add("gizli");
            game.reset(); wTime=600; bTime=600; baslatSatrancSayaci();
            if(mod==='online') database.ref('game').on('value', s=>{ let v=s.val(); if(v&&v.fen!==game.fen()){game.load(v.fen); board.position(v.fen); kontrolEtBittiMi(); } });
            
            if(board) board.destroy();
            board = Chessboard('myBoard', {
                draggable: true, position: 'start',
                pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png', 
                orientation: myColor==='b'&&mod==='online' ? 'black' : 'white',
                onDragStart: (s,p) => { if(game.game_over() || (mod==='online'&&game.turn()!==myColor)) return false; },
                onDrop: (s,t) => {
                    let m=game.move({from:s, to:t, promotion:'q'}); if(m===null) return 'snapback';
                    if(mod==='online') database.ref('game').set({fen:game.fen(), turn:game.turn()});
                    if(mod==='bot') setTimeout(()=>{ let m=game.moves(); game.move(m[Math.floor(Math.random()*m.length)]); board.position(game.fen()); kontrolEtBittiMi(); }, 250);
                    kontrolEtBittiMi();
                }
            });
        }
        function dereceliGir(){ document.getElementById("lobiButonlari").classList.add("gizli"); document.getElementById("beklemeEkrani").classList.remove("gizli"); database.ref('lobby').once('value', s=>{ let l=s.val(); if(!l||l.status==='empty'){database.ref('lobby').set({status:'waiting', p1:user}); database.ref('lobby').onDisconnect().set({status:'empty'}); myColor='w'; database.ref('lobby').on('child_changed', snap=>{if(snap.key==='status'&&snap.val()==='ready')baslatGeriSayim();});}else if(l.status==='waiting'){database.ref('lobby').update({status:'ready', p2:user}); database.ref('lobby').onDisconnect().set({status:'empty'}); myColor='b'; baslatGeriSayim();}else{alert("Dolu");beklemeyiIptalEt();} }); }
        function baslatGeriSayim(){ document.getElementById("beklemeIcerik").classList.add("gizli"); document.getElementById("geriSayimIcerik").classList.remove("gizli"); let c=5, i=setInterval(()=>{ c--; document.getElementById("geriSayimText").innerText=c; if(c<=0){clearInterval(i); oyunBaslat('online');} },1000); }
        function oyunModuSec(t){ if(t==='bot') oyunBaslat('bot'); }
        function beklemeyiIptalEt(){ database.ref('lobby').set({status:'empty'}); document.getElementById("beklemeEkrani").classList.add("gizli"); document.getElementById("lobiButonlari").classList.remove("gizli"); }
        function baslatSatrancSayaci(){ clearInterval(chessInterval); chessInterval=setInterval(()=>{ if(game.game_over()){clearInterval(chessInterval);return;} if(game.turn()==='w'){wTime--;document.getElementById("timerW").innerHTML=`‚ö™ ${Math.floor(wTime/60)}:${wTime%60<10?'0':''}${wTime%60}`;document.getElementById("timerW").classList.add("timer-active");document.getElementById("timerB").classList.remove("timer-active");}else{bTime--;document.getElementById("timerB").innerHTML=`‚ö´ ${Math.floor(bTime/60)}:${bTime%60<10?'0':''}${bTime%60}`;document.getElementById("timerB").classList.add("timer-active");document.getElementById("timerW").classList.remove("timer-active");} if(wTime<=0||bTime<=0){clearInterval(chessInterval);alert("S√ºre bitti!");} },1000); }
        function kontrolEtBittiMi(){ if(game.game_over()){clearInterval(chessInterval);alert("Oyun Bitti!");if(aktifMod==='online')database.ref('lobby').set({status:'empty'});} }
        function pesEt(){ alert("Pes ettin!"); if(aktifMod==='online')database.ref('lobby').set({status:'empty'}); location.reload(); }

        function yukleVeriler(){ getRef('gunluk').on('child_added',s=>{let d=s.val();document.getElementById("gunlukList").insertAdjacentHTML('afterbegin',`<div class="item-card" style="display:block;"><div style="display:flex; justify-content:space-between;"><b>üìÖ ${d.date}</b><button class="btn btn-yesil" style="padding:2px 10px; font-size:12px;" onclick="toggleOku('${s.key}')">Oku</button></div><div id="g_${s.key}" class="gizli" style="margin-top:10px;border-top:1px solid #ccc;padding-top:5px;">${d.txt}</div></div>`)}); getRef('todo').on('child_added',s=>{let d=s.val();if(!document.getElementById("gorev_"+s.key)){let i=d.durum==='basarili'?'‚úÖ':(d.durum==='basarisiz'?'‚ùå':'‚è≥'),st=d.durum==='basarili'?'basarili':(d.durum==='basarisiz'?'basarisiz':'');document.getElementById("todoList").innerHTML+=`<div id="gorev_${s.key}" class="item-card ${st}"><span>${d.txt} (${d.sure}sn)</span> ${i}</div>`;}}); getRef('notlar').on('child_added',s=>{let d=s.val(),r=d.sonuc>=50?'basarili':'basarisiz';document.getElementById("notListesi").innerHTML+=`<div class="item-card ${r}"><b>${d.ders}</b>: Ort: ${d.sonuc}</div>`;}); programTabloOlustur(); }
        function oneriYolla(){ let t=document.getElementById("oneriTur").value,k=document.getElementById("oneriKonu").value,m=document.getElementById("oneriMesaj").value; if(!k||!m)return alert("Doldur"); window.location.href=`mailto:mustafasoylemez2000@gmail.com?subject=[${t}] ${k} - ${user}&body=${m}`; }
        function gunlukEkle(){ let t=document.getElementById("gunlukIn").value; if(t){getRef('gunluk').push({txt:t,date:new Date().toLocaleDateString()});document.getElementById("gunlukIn").value="";} }
        function toggleOku(i){ document.getElementById("g_"+i).classList.toggle("gizli"); }
        function gorevEkle(){ let t=document.getElementById("todoIn").value,s=parseInt(document.getElementById("todoTime").value); if(!t||!s)return; let r=getRef('todo').push(); r.set({txt:t,sure:s,durum:'bekliyor'}); document.getElementById("todoIn").value=""; baslatGorevSayaci(r.key,t,s); }
        function baslatGorevSayaci(k,t,s){ let d=document.createElement("div");d.id="tmp_"+k;d.className="item-card";d.style.borderLeftColor="#f1c40f";d.innerHTML=`<span>${t}</span> <b id="c_${k}">${s}</b> <button class="btn btn-yesil" onclick="gorevSonuc('${k}','basarili')">Bitir</button>`;document.getElementById("todoList").prepend(d);let i=setInterval(()=>{s--;let e=document.getElementById("c_"+k);if(e)e.innerText=s;if(s<=0){clearInterval(i);gorevSonuc(k,'basarisiz');}if(!document.getElementById("tmp_"+k))clearInterval(i);},1000); }
        window.gorevSonuc=function(k,d){let e=document.getElementById("tmp_"+k);if(e)e.remove();getRef('todo/'+k).update({durum:d});}
        
        function notHesapla() { let d=document.getElementById("dersAdi").value,v=Number(document.getElementById("vizeNot").value),f=Number(document.getElementById("finalNot").value); if(d)getRef('notlar').push({ders:d+" (√úni)",sonuc:((v*0.4)+(f*0.6)).toFixed(1)}); }
        function liseHesapla() { let d=document.getElementById("liseDers").value,y1=Number(document.getElementById("yazili1").value),y2=Number(document.getElementById("yazili2").value),s=Number(document.getElementById("sozlu").value); if(d)getRef('notlar').push({ders:d+" (Lise)",sonuc:((y1+y2+s)/3).toFixed(1)}); }
        function tytHesapla() { let d=document.getElementById("tytDers").value,dr=Number(document.getElementById("tytDogru").value),yn=Number(document.getElementById("tytYanlis").value); if(d)getRef('notlar').push({ders:d+" (Net)",sonuc:(dr-(yn/4))}); }

        function programTabloOlustur(){ let t=document.querySelector("#programTablosu tbody");t.innerHTML=""; getRef('program').once('value',s=>{let d=s.val()||{}; ["09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00"].forEach((h,i)=>{let tr=document.createElement("tr");tr.innerHTML=`<td><b>${h}</b></td>`;for(let j=0;j<5;j++)tr.innerHTML+=`<td><input class="ders-input" id="d_${i}_${j}" value="${d['d_'+i+'_'+j]||''}"></td>`;t.appendChild(tr);});}); }
        function programKaydet(){ let v={};document.querySelectorAll(".ders-input").forEach(i=>v[i.id]=i.value);getRef('program').set(v).then(()=>alert("Kaydedildi")); }
        function baslatSohbet(){ database.ref('chat').on('child_added',s=>{let m=s.val(),st=m.u===user?"background:#6c5ce7;color:white;margin-left:auto;":"background:#eee;color:black;";document.getElementById("chatArea").innerHTML+=`<div style="padding:8px;margin:5px;border-radius:10px;width:fit-content;${st}"><b>${m.u}:</b> ${m.t}</div>`;document.getElementById("chatArea").scrollTop=99999;}); }
        function chatYolla(){ let t=document.getElementById("chatIn").value;if(t){database.ref('chat').push({u:user,t:t});document.getElementById("chatIn").value="";} }
        function sayfaGec(i){ document.querySelectorAll(".page").forEach(p=>p.classList.remove("active")); document.querySelectorAll(".menu-item").forEach(m=>m.classList.remove("active")); document.getElementById(i).classList.add("active"); event.currentTarget.classList.add("active"); }
    </script>
</body>
</html>
