<!DOCTYPE html>
<html lang="tr">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>√ñƒürenci Portalƒ±m</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.2/chess.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        :root { --primary: #6c5ce7; --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); --panel: #ffffff; --text: #2d3436; --success: #00b894; --danger: #ff7675; }
        body.koyu-mod { --primary: #a29bfe; --panel: #2d3436; --text: #dfe6e9; --bg-gradient: linear-gradient(135deg, #232526 0%, #414345 100%); }
        body { font-family: 'Poppins', sans-serif; background: var(--bg-gradient); margin: 0; min-height: 100vh; display: flex; justify-content: center; align-items: center; color: var(--text); overflow: hidden; }
        
        @media screen and (max-width: 768px) {
            body, .container { flex-direction: column !important; width: 100% !important; padding: 0 !important; height: 100vh !important; border-radius: 0 !important; }
            .sidebar { width: 100% !important; height: auto !important; padding: 10px !important; display: flex; overflow-x: auto; gap: 10px; border-bottom: 1px solid #eee; border-right: none !important; }
            .sidebar h3, .sidebar p, .sidebar button { display: none; }
            .menu-item { flex-direction: column; font-size: 10px; padding: 5px; text-align: center; min-width: 60px; }
            .menu-item i { font-size: 18px; margin-bottom: 3px; }
            .auth-box { width: 90% !important; padding: 30px 20px !important; }
            #myBoard { width: 300px !important; }
            .content { padding: 15px !important; }
        }

        .container { background: var(--panel); width: 1200px; height: 800px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); display: flex; overflow: hidden; position: relative; }
        
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); z-index:999; display:flex; justify-content:center; align-items:center; }
        .auth-box { padding: 50px 40px; width: 380px; text-align: center; background: rgba(255, 255, 255, 0.85); border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); }
        .input-group input { width: 100%; padding: 15px; margin-bottom: 15px; border: 2px solid #eee; border-radius: 12px; background: #f9f9f9; outline: none; box-sizing: border-box; }
        .auth-btn { width: 100%; padding: 15px; border: none; border-radius: 12px; background: linear-gradient(135deg, var(--primary), #5649c0); color: white; font-weight: 600; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .auth-btn:hover { transform: scale(1.02); }
        .link-text { color: var(--primary); font-weight: 600; cursor: pointer; font-size: 13px; margin-top: 15px; display: block; }

        .sidebar { width: 250px; background: rgba(0,0,0,0.02); padding: 25px; display: flex; flex-direction: column; gap: 10px; border-right: 1px solid rgba(0,0,0,0.05); }
        .content { flex: 1; padding: 40px; overflow-y: auto; }
        .menu-item { padding: 12px; cursor: pointer; border-radius: 12px; display: flex; gap: 12px; align-items: center; color: #666; transition: 0.2s; }
        .menu-item:hover, .menu-item.active { background: var(--primary); color: white; }
        .page { display: none; animation: slideUp 0.4s ease-out; } .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .gizli { display: none !important; }

        .chess-wrapper { background: #f8f9fa; padding: 20px; border-radius: 20px; display: inline-block; border: 1px solid #eee; }
        #myBoard { margin: 0 auto; width: 400px; }
        .timers { display: flex; justify-content: space-between; width: 400px; margin: 0 auto 15px auto; }
        .timer-box { padding: 8px 15px; border-radius: 10px; background: #e0e0e0; color: #555; font-weight: bold; width: 120px; text-align: center; }
        .timer-active { background: #fff; border: 2px solid var(--success); color: var(--success); transform: scale(1.05); }

        .pomodoro-circle { width: 220px; height: 220px; border-radius: 50%; border: 8px solid #eee; border-top-color: var(--primary); display: flex; justify-content: center; align-items: center; font-size: 50px; font-weight: bold; margin: 20px auto; color: var(--text); }
        .item-card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 10px; border-left: 5px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .basarili { border-left-color: var(--success); } .basarisiz { border-left-color: var(--danger); }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: 600; }
        .btn-yesil { background: var(--success); } .btn-kirmizi { background: var(--danger); } .btn-gri { background: #636e72; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        #beklemeEkrani { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.98); z-index: 99; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="authScreen" class="overlay">
        <div class="auth-box">
            <h2 id="authTitle" style="color:#2d3436;">Giri≈ü Yap</h2>
            <div class="input-group"><input type="text" id="kAdiInput" placeholder="Kullanƒ±cƒ± Adƒ±"></div>
            <div id="emailDiv" class="input-group gizli"><input type="email" id="emailInput" placeholder="E-Posta"></div>
            <div class="input-group"><input type="password" id="sifreInput" placeholder="≈ûifre"></div>
            <button onclick="islemYap()" id="btnIslem" class="auth-btn">Giri≈ü Yap</button>
            <span onclick="sifreSifirla()" class="link-text">≈ûifremi Unuttum?</span>
            <span onclick="modDegistir()" id="toggleText" class="link-text" style="color:#666; margin-top:20px;">Hesabƒ±n yok mu? <b style="color:var(--primary)">Kayƒ±t Ol</b></span>
        </div>
    </div>

    <div id="appScreen" class="container gizli">
        <div class="sidebar">
            <h3 style="text-align:center; color: var(--primary); margin-bottom: 20px;"><i class="fas fa-graduation-cap"></i> Portal</h3>
            <div class="menu-item active" onclick="sayfaGec('dashboard')"><i class="fas fa-home"></i> Ana Sayfa</div>
            <div class="menu-item" onclick="sayfaGec('pomodoro')"><i class="fas fa-clock"></i> Ders & Mola</div>
            <div class="menu-item" onclick="sayfaGec('oyunlar')"><i class="fas fa-chess-king"></i> Satran√ß Arena</div>
            <div class="menu-item" onclick="sayfaGec('todo')"><i class="fas fa-stopwatch"></i> Zamanlƒ± G√∂rev</div>
            <div class="menu-item" onclick="sayfaGec('notlar')"><i class="fas fa-calculator"></i> Not Hesapla</div>
            <div class="menu-item" onclick="sayfaGec('program')"><i class="fas fa-calendar-alt"></i> Ders Programƒ±</div>
            <div class="menu-item" onclick="sayfaGec('gunluk')"><i class="fas fa-book"></i> Gizli G√ºnl√ºk</div>
            <div class="menu-item" onclick="sayfaGec('sohbet')"><i class="fas fa-comments"></i> Sohbet</div>
            <div class="menu-item" onclick="sayfaGec('iletisim')"><i class="fas fa-envelope"></i> ≈ûikayet/√ñneri</div>
            <div style="margin-top:auto; text-align:center;">
                <p id="karsilama" style="font-size:13px; font-weight:600; color:#555;"></p>
                <button onclick="cikisYap()" class="btn btn-kirmizi" style="width:100%; font-size:12px;">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </div>

        <div class="content">
            <div id="dashboard" class="page active">
                <h1 style="color:var(--primary);">üëã Ho≈ügeldin, <span id="dashUser"></span></h1>
                <div style="display:flex; gap:20px; margin-top:30px;">
                    <div style="flex:1; background:#a29bfe; color:white; padding:25px; border-radius:15px;"><h3>Satran√ß Puanƒ±</h3><h1 id="dashPuan">0</h1></div>
                    <div style="flex:1; background:#00b894; color:white; padding:25px; border-radius:15px;"><h3>Bekleyen G√∂rev</h3><h1 id="dashGorev">0</h1></div>
                </div>
            </div>

            <div id="pomodoro" class="page" style="text-align:center;">
                <h2>üçÖ Pomodoro</h2>
                <div style="display:flex; justify-content:center; gap:10px; margin-bottom:10px;">
                    <div style="text-align:left;">
                        <label style="font-size:12px; font-weight:bold;">Ders (dk)</label>
                        <input type="number" id="pomoDersSure" value="25" style="width:80px; text-align:center;">
                    </div>
                    <div style="text-align:left;">
                        <label style="font-size:12px; font-weight:bold;">Mola (dk)</label>
                        <input type="number" id="pomoMolaSure" value="5" style="width:80px; text-align:center;">
                    </div>
                </div>
                <div class="pomodoro-circle" id="pomoSure">25:00</div>
                <p id="pomoDurumYazisi" style="font-size:16px; color:#888; font-weight:600; min-height: 24px;"></p>
                <div style="margin-top:20px;">
                    <button class="btn btn-yesil" onclick="dersBaslat()">Ders Ba≈ülat</button>
                    <button class="btn btn-yesil" style="background:#0984e3;" onclick="molaBaslat()">Mola Ba≈ülat</button>
                    <button id="pomoDurBtn" class="btn btn-kirmizi" onclick="pomoDuraklat()">Durdur</button>
                </div>
            </div>

            <div id="oyunlar" class="page" style="position: relative;">
                <div id="beklemeEkrani" class="gizli"><div id="beklemeIcerik"><div class="spinner"></div><h2>RAKƒ∞P ARANIYOR...</h2><button onclick="beklemeyiIptalEt()" class="btn btn-kirmizi">ƒ∞ptal</button></div><div id="geriSayimIcerik" class="gizli" style="text-align:center;"><h2>RAKƒ∞P BULUNDU!</h2><h1 id="geriSayimText" style="font-size:100px; color:var(--primary); margin:0;">5</h1></div></div>
                <h2 style="text-align:center;">‚ôüÔ∏è Satran√ß Arenasƒ±</h2>
                <div id="lobiButonlari" style="text-align:center; padding:40px; background:white; border-radius:15px;"><button class="btn btn-gri" onclick="oyunModuSec('bot')">ü§ñ Bot</button> <button class="btn btn-yesil" onclick="dereceliGir()">üî• Dereceli</button></div>
                <div id="oyunAlani" class="gizli" style="text-align:center;">
                    <div class="chess-wrapper">
                        <div class="timers"><div id="timerW" class="timer-box">‚ö™ 10:00</div><div id="timerB" class="timer-box">‚ö´ 10:00</div></div>
                        <div id="myBoard"></div>
                        <div style="margin-top:20px;"><button class="btn btn-kirmizi" onclick="pesEt()">Pes Et</button></div>
                    </div>
                </div>
            </div>

            <div id="todo" class="page"><h2>‚è±Ô∏è Zamanlƒ± G√∂revler</h2><div style="display:flex; gap:10px;"><input id="todoIn" placeholder="G√∂rev?"><input type="number" id="todoTime" placeholder="Sn" style="width:100px;"><button class="btn btn-yesil" onclick="gorevEkle()">Ba≈ülat</button></div><div id="todoList" style="margin-top:20px;"></div></div>
            <div id="notlar" class="page"><h2>üßÆ Not Hesapla</h2><div style="display:flex; gap:10px;"><input id="dersAdi" placeholder="Ders"><input id="vizeNot" type="number" placeholder="Vize"><input id="finalNot" type="number" placeholder="Final"><button class="btn btn-yesil" onclick="notHesapla()">Hesapla</button></div><div id="notListesi" style="margin-top:20px;"></div></div>
            <div id="program" class="page"><h2>üìÖ Program</h2><table id="programTablosu"><thead><tr><th>Saat</th><th>Pzt</th><th>Sal</th><th>√áar</th><th>Per</th><th>Cum</th></tr></thead><tbody></tbody></table><button class="btn btn-yesil" style="margin-top:15px;" onclick="programKaydet()">Kaydet</button></div>
            <div id="gunluk" class="page"><h2>üìî G√ºnl√ºk</h2><textarea id="gunlukIn" rows="5" placeholder="Yaz..."></textarea><button class="btn btn-yesil" onclick="gunlukEkle()">Kaydet</button><div id="gunlukList" style="margin-top:20px;"></div></div>
            <div id="sohbet" class="page"><h2>üí¨ Sohbet</h2><div id="chatArea" style="height:400px; overflow-y:scroll; border:1px solid #eee; padding:15px; border-radius:15px; background:#fdfdfd; margin-bottom:15px;"></div><div style="display:flex; gap:10px;"><input id="chatIn" placeholder="Mesaj..."><button class="btn btn-yesil" style="width:100px;" onclick="chatYolla()">Yolla</button></div></div>
            <div id="iletisim" class="page"><h2>üì¨ ≈ûikayet/√ñneri</h2><select id="oneriTur"><option>√ñneri</option><option>≈ûikayet</option></select><input id="oneriKonu" placeholder="Konu"><textarea id="oneriMesaj" rows="5" placeholder="Mesaj..."></textarea><button class="btn btn-yesil" onclick="oneriYolla()">G√∂nder</button></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyDxsw-OTjvlrPvscjO4LsGzKEceKOW-Iuc",
          authDomain: "ogrenci-portali-f4cad.firebaseapp.com",
          databaseURL: "https://ogrenci-portali-f4cad-default-rtdb.firebaseio.com",
          projectId: "ogrenci-portali-f4cad",
          storageBucket: "ogrenci-portali-f4cad.firebasestorage.app",
          messagingSenderId: "901945087688",
          appId: "1:901945087688:web:24f1a877f49a15edc577fd",
          measurementId: "G-JEL3H6H45T"
        };

        try { firebase.initializeApp(firebaseConfig); } catch(e){ console.error(e); }
        const database = firebase.database();
        const auth = firebase.auth();

        let user = null, kayit = false;
        let board = null, game = new Chess();
        let myColor = 'w', aktifMod = null, wTime=600, bTime=600, chessInterval=null;

        if(localStorage.getItem("koyuMod") === "1") document.body.classList.add("koyu-mod");

        function modDegistir() { kayit = !kayit; document.getElementById("authTitle").innerText = kayit ? "Kayƒ±t Ol" : "Giri≈ü Yap"; document.getElementById("btnIslem").innerText = kayit ? "Kayƒ±t Ol" : "Giri≈ü Yap"; document.getElementById("toggleText").innerHTML = kayit ? "Hesabƒ±n var mƒ±? <b>Giri≈ü Yap</b>" : "Hesabƒ±n yok mu? <b>Kayƒ±t Ol</b>"; kayit ? document.getElementById("emailDiv").classList.remove("gizli") : document.getElementById("emailDiv").classList.add("gizli"); }
        function islemYap() {
            let k=document.getElementById("kAdiInput").value.trim(), p=document.getElementById("sifreInput").value;
            if(!k||!p) return alert("Doldur!");
            if(kayit) {
                let m=document.getElementById("emailInput").value.trim(); if(!m) return alert("Email lazƒ±m!");
                database.ref('users').orderByChild('username').equalTo(k).once('value', s=>{
                    if(s.exists()) alert("Alƒ±nmƒ±≈ü!");
                    else auth.createUserWithEmailAndPassword(m,p).then(c=>{ database.ref('users/'+c.user.uid).set({username:k,email:m}); alert("Kayƒ±t OK!"); }).catch(e=>alert(e.message));
                });
            } else {
                database.ref('users').orderByChild('username').equalTo(k).once('value', s=>{
                    if(s.exists()) auth.signInWithEmailAndPassword(Object.values(s.val())[0].email,p).catch(e=>alert("≈ûifre Yanlƒ±≈ü!"));
                    else alert("Yok!");
                });
            }
        }
        auth.onAuthStateChanged(u=>{ if(u){ database.ref('users/'+u.uid).once('value').then(s=>{ user=s.exists()?s.val().username:u.email.split('@')[0]; document.getElementById("authScreen").classList.add("gizli"); document.getElementById("appScreen").classList.remove("gizli"); document.getElementById("karsilama").innerText="üë§ "+user; document.getElementById("dashUser").innerText=user; yukleVeriler(); baslatSohbet(); }); } else { document.getElementById("authScreen").classList.remove("gizli"); document.getElementById("appScreen").classList.add("gizli"); } });
        function cikisYap(){auth.signOut().then(()=>location.reload());}
        function sifreSifirla(){let m=prompt("Email:");if(m)auth.sendPasswordResetEmail(m).then(()=>alert("G√∂nderildi")).catch(e=>alert(e.message));}
        function getRef(p){return database.ref(p+'/'+user);}

        let pInt, pSur=25*60, pDur=false, pMod=""; 
        function dersBaslat() {
            let dk = parseInt(document.getElementById("pomoDersSure").value) || 25;
            if(pMod === 'mola' && pSur > 0 && pDur) return alert("Moladasƒ±n!");
            if(pMod !== 'ders') { clearInterval(pInt); pSur = dk * 60; pMod = 'ders'; }
            pDur = true; document.getElementById("pomoDurBtn").innerText = "Durdur"; 
            document.getElementById("pomoDurumYazisi").innerText = "üìö DERS (" + dk + " dk)";
            sayac();
        }
        function molaBaslat() {
            let dk = parseInt(document.getElementById("pomoMolaSure").value) || 5;
            if(pMod === 'ders' && pSur > 0 && pDur) return alert("Derstesin!");
            if(pMod !== 'mola') { clearInterval(pInt); pSur = dk * 60; pMod = 'mola'; }
            pDur = true; document.getElementById("pomoDurBtn").innerText = "Durdur";
            document.getElementById("pomoDurumYazisi").innerText = "‚òï MOLA (" + dk + " dk)";
            sayac();
        }
        function sayac() {
            clearInterval(pInt); pInt = setInterval(() => {
                pSur--; let m=Math.floor(pSur/60), s=pSur%60;
                document.getElementById("pomoSure").innerText = `${m}:${s<10?'0':''}${s}`;
                if(pSur<=0) { clearInterval(pInt); alert("S√ºre bitti!"); pDur = false; }
            }, 1000);
        }
        function pomoDuraklat() { if(pDur){clearInterval(pInt);pDur=false;document.getElementById("pomoDurBtn").innerText="Devam Et";}else{pDur=true;document.getElementById("pomoDurBtn").innerText="Durdur";sayac();} }

        function oyunBaslat(mod) {
            aktifMod = mod; document.getElementById("beklemeEkrani").classList.add("gizli"); document.getElementById("oyunAlani").classList.remove("gizli"); document.getElementById("lobiButonlari").classList.add("gizli");
            game.reset(); wTime=600; bTime=600; baslatSatrancSayaci();
            if(mod==='online') database.ref('game').on('value', s=>{ let v=s.val(); if(v&&v.fen!==game.fen()){game.load(v.fen); board.position(v.fen); kontrolEtBittiMi();} });
            
            if(board) board.destroy();
            board = Chessboard('myBoard', {
                draggable: true, position: 'start',
                pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png', 
                orientation: myColor==='b'&&mod==='online' ? 'black' : 'white',
                onDragStart: (s,p) => { if(game.game_over() || (mod==='online'&&game.turn()!==myColor)) return false; },
                onDrop: (s,t) => {
                    let m=game.move({from:s, to:t, promotion:'q'}); if(m===null) return 'snapback';
                    if(mod==='online') database.ref('game').set({fen:game.fen(), turn:game.turn()});
                    if(mod==='bot') setTimeout(()=>{ let m=game.moves(); game.move(m[Math.floor(Math.random()*m.length)]); board.position(game.fen()); kontrolEtBittiMi(); }, 250);
                    kontrolEtBittiMi();
                }
            });
        }
        function dereceliGir(){ document.getElementById("lobiButonlari").classList.add("gizli"); document.getElementById("beklemeEkrani").classList.remove("gizli"); database.ref('lobby').once('value', s=>{ let l=s.val(); if(!l||l.status==='empty'){database.ref('lobby').set({status:'waiting', p1:user}); myColor='w'; database.ref('lobby').on('child_changed', snap=>{if(snap.val()==='ready')baslatGeriSayim();});}else if(l.status==='waiting'){database.ref('lobby').update({status:'ready', p2:user}); myColor='b'; baslatGeriSayim();}else{alert("Dolu");beklemeyiIptalEt();} }); }
        function baslatGeriSayim(){ document.getElementById("beklemeIcerik").classList.add("gizli"); document.getElementById("geriSayimIcerik").classList.remove("gizli"); let c=5, i=setInterval(()=>{ c--; document.getElementById("geriSayimText").innerText=c; if(c<=0){clearInterval(i); oyunBaslat('online');} },1000); }
        function oyunModuSec(t){ if(t==='bot') oyunBaslat('bot'); }
        function beklemeyiIptalEt(){ database.ref('lobby').set({status:'empty'}); document.getElementById("beklemeEkrani").classList.add("gizli"); document.getElementById("lobiButonlari").classList.remove("gizli"); }
        function baslatSatrancSayaci(){ clearInterval(chessInterval); chessInterval=setInterval(()=>{ if(game.game_over()){clearInterval(chessInterval);return;} if(game.turn()==='w'){wTime--;document.getElementById("timerW").innerHTML=`‚ö™ ${Math.floor(wTime/60)}:${wTime%60}`;document.getElementById("timerW").classList.add("timer-active");document.getElementById("timerB").classList.remove("timer-active");}else{bTime--;document.getElementById("timerB").innerHTML=`‚ö´ ${Math.floor(bTime/60)}:${bTime%60}`;document.getElementById("timerB").classList.add("timer-active");document.getElementById("timerW").classList.remove("timer-active");} if(wTime<=0||bTime<=0){clearInterval(chessInterval);alert("S√ºre bitti!");} },1000); }
        function kontrolEtBittiMi(){ if(game.game_over()){clearInterval(chessInterval);alert("Oyun Bitti!");if(aktifMod==='online')database.ref('lobby').set({status:'empty'});} }
        function pesEt(){ alert("Pes ettin!"); if(aktifMod==='online')database.ref('lobby').set({status:'empty'}); location.reload(); }

        function yukleVeriler(){ getRef('gunluk').on('child_added',s=>{let d=s.val();document.getElementById("gunlukList").insertAdjacentHTML('afterbegin',`<div class="item-card" style="display:block;"><div style="display:flex; justify-content:space-between;"><b>üìÖ ${d.date}</b><button class="btn btn-yesil" style="padding:2px 10px; font-size:12px;" onclick="toggleOku('${s.key}')">Oku</button></div><div id="g_${s.key}" class="gizli" style="margin-top:10px;border-top:1px solid #ccc;padding-top:5px;">${d.txt}</div></div>`)}); getRef('todo').on('child_added',s=>{let d=s.val();if(!document.getElementById("gorev_"+s.key)){let i=d.durum==='basarili'?'‚úÖ':(d.durum==='basarisiz'?'‚ùå':'‚è≥'),st=d.durum==='basarili'?'basarili':(d.durum==='basarisiz'?'basarisiz':'');document.getElementById("todoList").innerHTML+=`<div id="gorev_${s.key}" class="item-card ${st}"><span>${d.txt} (${d.sure}sn)</span> ${i}</div>`;}}); getRef('notlar').on('child_added',s=>{let d=s.val(),r=d.sonuc>=50?'basarili':'basarisiz';document.getElementById("notListesi").innerHTML+=`<div class="item-card ${r}"><b>${d.ders}</b>: Ort: ${d.sonuc}</div>`;}); programTabloOlustur(); }
        function oneriYolla(){ let t=document.getElementById("oneriTur").value,k=document.getElementById("oneriKonu").value,m=document.getElementById("oneriMesaj").value; if(!k||!m)return alert("Doldur"); window.location.href=`mailto:mustafasoylemez458@gmail.com?subject=[${t}] ${k} - ${user}&body=${m}`; }
        function gunlukEkle(){ let t=document.getElementById("gunlukIn").value; if(t){getRef('gunluk').push({txt:t,date:new Date().toLocaleDateString()});document.getElementById("gunlukIn").value="";} }
        function toggleOku(i){ document.getElementById("g_"+i).classList.toggle("gizli"); }
        function gorevEkle(){ let t=document.getElementById("todoIn").value,s=parseInt(document.getElementById("todoTime").value); if(!t||!s)return; let r=getRef('todo').push(); r.set({txt:t,sure:s,durum:'bekliyor'}); document.getElementById("todoIn").value=""; baslatGorevSayaci(r.key,t,s); }
        function baslatGorevSayaci(k,t,s){ let d=document.createElement("div");d.id="tmp_"+k;d.className="item-card";d.style.borderLeftColor="#f1c40f";d.innerHTML=`<span>${t}</span> <b id="c_${k}">${s}</b> <button class="btn btn-yesil" onclick="gorevSonuc('${k}','basarili')">Bitir</button>`;document.getElementById("todoList").prepend(d);let i=setInterval(()=>{s--;let e=document.getElementById("c_"+k);if(e)e.innerText=s;if(s<=0){clearInterval(i);gorevSonuc(k,'basarisiz');}if(!document.getElementById("tmp_"+k))clearInterval(i);},1000); }
        window.gorevSonuc=function(k,d){let e=document.getElementById("tmp_"+k);if(e)e.remove();getRef('todo/'+k).update({durum:d});}
        function notHesapla(){ let d=document.getElementById("dersAdi").value,v=Number(document.getElementById("vizeNot").value),f=Number(document.getElementById("finalNot").value); if(d)getRef('notlar').push({ders:d,sonuc:((v*0.4)+(f*0.6)).toFixed(1)}); }
        function programTabloOlustur(){ let t=document.querySelector("#programTablosu tbody");t.innerHTML=""; getRef('program').once('value',s=>{let d=s.val()||{}; ["09:00","10:00","11:00","13:00","14:00"].forEach((h,i)=>{let tr=document.createElement("tr");tr.innerHTML=`<td><b>${h}</b></td>`;for(let j=0;j<5;j++)tr.innerHTML+=`<td><input class="ders-input" id="d_${i}_${j}" value="${d['d_'+i+'_'+j]||''}"></td>`;t.appendChild(tr);});}); }
        function programKaydet(){ let v={};document.querySelectorAll(".ders-input").forEach(i=>v[i.id]=i.value);getRef('program').set(v).then(()=>alert("Kaydedildi")); }
        function baslatSohbet(){ database.ref('chat').on('child_added',s=>{let m=s.val(),st=m.u===user?"background:#6c5ce7;color:white;margin-left:auto;":"background:#eee;color:black;";document.getElementById("chatArea").innerHTML+=`<div style="padding:8px;margin:5px;border-radius:10px;width:fit-content;${st}"><b>${m.u}:</b> ${m.t}</div>`;document.getElementById("chatArea").scrollTop=99999;}); }
        function chatYolla(){ let t=document.getElementById("chatIn").value;if(t){database.ref('chat').push({u:user,t:t});document.getElementById("chatIn").value="";} }
        function sayfaGec(i){ document.querySelectorAll(".page").forEach(p=>p.classList.remove("active")); document.querySelectorAll(".menu-item").forEach(m=>m.classList.remove("active")); document.getElementById(i).classList.add("active"); event.currentTarget.classList.add("active"); }
    </script>
</body>
</html>
